<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - E-Commerce</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, #8b7ed8 0%, #a18cd1 100%);
            color: white;
            padding: 1.2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.8rem;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 3rem;
            align-items: center;
            margin: 0;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1rem;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 6px;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-success {
            background: #28a745;
            color: white;
            font-size: 1.1rem;
            padding: 0.75rem 2rem;
        }

        .btn-success:hover {
            background: #218838;
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Product Details */
        .product-details {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 2rem;
        }

        .product-image-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-main-image {
            width: 100%;
            max-width: 400px;
            height: 400px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .product-info-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .product-title {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .product-price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 1rem;
        }

        .product-vendor {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 1rem;
        }

        .product-description {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #34495e;
            margin-bottom: 2rem;
        }

        .product-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .quantity-selector label {
            font-weight: bold;
        }

        .quantity-selector input {
            width: 80px;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        /* Error Message */
        .error-message {
            background: white;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .error-message h3 {
            color: #e74c3c;
            margin-bottom: 1rem;
        }

        /* Footer */
        footer {
            background: #2c3e50;
            color: white;
            padding: 3rem 0 1rem 0;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1.5fr;
            gap: 3rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: white;
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
        }

        .footer-section ul li {
            margin-bottom: 0.8rem;
        }

        .footer-section a {
            color: #bdc3c7;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-section p {
            color: #bdc3c7;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .contact-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            color: #bdc3c7;
        }

        .newsletter-form {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .newsletter-form input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #34495e;
            border-radius: 6px;
            background: #34495e;
            color: white;
        }

        .newsletter-form input::placeholder {
            color: #bdc3c7;
        }

        .newsletter-form button {
            padding: 0.8rem 1.5rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .newsletter-form button:hover {
            background: #2980b9;
        }

        .footer-bottom {
            border-top: 1px solid #34495e;
            padding-top: 1.5rem;
            text-align: center;
            color: #bdc3c7;
        }

        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .modal-content h3 {
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .modal-content p {
            margin-bottom: 2rem;
            color: #7f8c8d;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                gap: 1rem;
            }

            .footer-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .newsletter-form {
                flex-direction: column;
            }

            .product-details {
                grid-template-columns: 1fr;
                gap: 2rem;
                padding: 1.5rem;
            }

            .product-title {
                font-size: 1.5rem;
            }

            .product-price {
                font-size: 2rem;
            }

            .product-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <a href="index.html" class="logo">
                <div class="logo-icon">üì¶</div>
                MultiVendor
            </a>
            <ul class="nav-links">
                <li><a href="Home.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="Allproduct.html">Product</a></li>
                <li><a href="categories.html">Categories</a></li>
                <li><a href="admin-login.html" id="loginLink">Admin Login</a></li>
                <li><a href="user-login.html" id="userLoginLink">User Login</a></li>
                <li><a href="#" class="cart-link" id="cartLink" style="display: none;">Cart</a></li>
                <li><a href="#" onclick="logout()" id="logoutLink" style="display: none;">Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="index.html">Home</a> > <span id="breadcrumbProduct">Product Details</span>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner"></div>
            <p>Loading product details...</p>
        </div>

        <!-- Product Details Container -->
        <div id="productContainer"></div>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h3>Login Required</h3>
            <p>Please log in to add items to your cart.</p>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <button class="btn btn-primary" onclick="demoLogin()">Demo Login</button>
                <button class="btn btn-secondary" onclick="closeLoginModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>About Us</h3>
                    <p>MultiVendor Marketplace connects buyers and sellers worldwide, providing a secure and efficient platform for e-commerce.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">About</a></li>
                        <li><a href="#">Categories</a></li>
                        <li><a href="#">Support</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <div class="contact-info">
                        <span>üìß</span>
                        <span>info@multivendor.com</span>
                    </div>
                    <div class="contact-info">
                        <span>üìû</span>
                        <span>+1 (555) 123-4567</span>
                    </div>
                    <div class="contact-info">
                        <span>üìç</span>
                        <span>123 Business St, City, State 12345</span>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Subscribe to get updates on new products and offers.</p>
                    <div class="newsletter-form">
                        <input type="email" placeholder="Enter your email">
                        <button type="button">Subscribe</button>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 MultiVendor Marketplace. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        const apiUrl = "http://localhost:5116/api";
        let currentProduct = null;
        let isUserLoggedIn = false;

        // Initialize page
        window.addEventListener('DOMContentLoaded', function () {
            checkLoginStatus();
            updateNavbar();
            loadProductDetails();
        });

        function checkLoginStatus() {
            const user = localStorage.getItem("loggedInUser");
            isUserLoggedIn = !!user;
        }

        function updateNavbar() {
            const cartLink = document.getElementById('cartLink');
            const loginLink = document.getElementById('loginLink');
            const userLoginLink = document.getElementById('userLoginLink');
            const logoutLink = document.getElementById('logoutLink');

            if (isUserLoggedIn) {
                cartLink.style.display = 'block';
                loginLink.style.display = 'none';
                userLoginLink.style.display = 'none';
                logoutLink.style.display = 'block';
            } else {
                cartLink.style.display = 'none';
                loginLink.style.display = 'block';
                userLoginLink.style.display = 'block';
                logoutLink.style.display = 'none';
            }
        }

        function logout() {
            isUserLoggedIn = false;
            localStorage.removeItem("loggedInUser");
            updateNavbar();
            alert('You have been logged out successfully!');
        }

        function getProductIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        async function loadProductDetails() {
            const productId = getProductIdFromUrl();
            
            if (!productId) {
                showError('No product ID specified in URL');
                return;
            }

            const loadingSpinner = document.getElementById('loadingSpinner');
            const productContainer = document.getElementById('productContainer');

            try {
                loadingSpinner.style.display = 'block';

                const response = await fetch(`${apiUrl}/Product/${productId}`);
                if (!response.ok) {
                    throw new Error(`Failed to load product: ${response.status} ${response.statusText}`);
                }

                const product = await response.json();
                console.log("Product details:", product);

                // Normalize product data
                currentProduct = {
                    id: product.id || product.productId,
                    name: product.name || product.productName || 'Unnamed Product',
                    description: product.description || product.productDescription || 'No description available',
                    price: parseFloat(product.price || product.productPrice) || 0,
                    image: product.image || product.productImage || '/api/placeholder/400/400',
                    vendor: product.vendor || product.vendorName || product.user?.username || 'Unknown Vendor',
                    categoryId: product.categoryId || null
                };

                displayProductDetails(currentProduct);

            } catch (error) {
                console.error('Error loading product details:', error);
                showError(`Unable to load product details: ${error.message}`);
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        function displayProductDetails(product) {
            const productContainer = document.getElementById('productContainer');
            const breadcrumbProduct = document.getElementById('breadcrumbProduct');
            
            // Update page title and breadcrumb
            document.title = `${product.name} - E-Commerce`;
            breadcrumbProduct.textContent = product.name;

            // Handle image URL
            let imageUrl = product.image;
            if (!imageUrl || imageUrl === 'string' || imageUrl === '') {
                imageUrl = '/assets/no-image.png';
            } else if (!imageUrl.startsWith('http') && !imageUrl.startsWith('/')) {
                imageUrl = `${apiUrl}/Images/${imageUrl}`;
            }

            productContainer.innerHTML = `
                <div class="product-details">
                    <div class="product-image-section">
                        <img src="${imageUrl}" alt="${product.name}" class="product-main-image"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/400x400/f8f9fa/6c757d?text=No+Image';">
                    </div>
                    
                    <div class="product-info-section">
                        <h1 class="product-title">${product.name}</h1>
                        <div class="product-price">‚Çπ${product.price.toFixed(2)}</div>
                        <div class="product-vendor">üë§ Sold by: <strong>${product.vendor}</strong></div>
                        
                        <div class="product-description">
                            <h3 style="margin-bottom: 0.5rem; color: #2c3e50;">Description</h3>
                            <p>${product.description}</p>
                        </div>
                        
                        <div class="quantity-selector">
                            <label for="quantity">Quantity:</label>
                            <input type="number" id="quantity" value="1" min="1" max="10">
                        </div>
                        
                        <div class="product-actions">
                            <button class="btn btn-success" onclick="addToCart(${product.id})">
                                üõí Add to Cart
                            </button>
                            <button class="btn btn-secondary" onclick="goBack()">
                                ‚Üê Back to Products
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function showError(message) {
            const productContainer = document.getElementById('productContainer');
            productContainer.innerHTML = `
                <div class="error-message">
                    <h3>‚ö†Ô∏è Error</h3>
                    <p>${message}</p>
                    <p>Please check your connection and ensure the API server is running.</p>
                    <button onclick="loadProductDetails()" class="btn btn-primary">Retry</button>
                    <button onclick="goBack()" class="btn btn-secondary" style="margin-left: 1rem;">Back to Products</button>
                </div>
            `;
        }

        function addToCart(productId) {
            if (!isUserLoggedIn) {
                showLoginModal();
                return;
            }

            const quantity = document.getElementById('quantity')?.value || 1;
            
            if (currentProduct) {
                alert(`${currentProduct.name} (Qty: ${quantity}) added to cart!`);
                console.log('Product added to cart:', {
                    product: currentProduct,
                    quantity: parseInt(quantity)
                });
            }
        }

        function goBack() {
            // Check if there's a previous page in history
            if (document.referrer && document.referrer.includes(window.location.origin)) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) modal.classList.add('show');
        }

        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) modal.classList.remove('show');
        }

        function demoLogin() {
            isUserLoggedIn = true;
            localStorage.setItem("loggedInUser", JSON.stringify({ demo: true }));
            updateNavbar();
            closeLoginModal();
            alert('Demo login successful! You can now add items to cart.');
        }

        // Close login modal when clicking outside
        const loginModal = document.getElementById('loginModal');
        if (loginModal) {
            loginModal.addEventListener('click', function (e) {
                if (e.target === this) {
                    closeLoginModal();
                }
            });
        }
    </script>
</body>
</html>